<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: robots-signals.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: robots-signals.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module robots-signals scans for the signals directory and each file's export function
 * becomes a signal with the filename
 */


/**
 * @class
 */
var signals = function() {
	/** @type {Object} the chalk object  */
	this.chalk			= {};
	/** @type {Object} fs for the filesystem package */
	this.fs				= {};
	/** @type {Object} path for the path package */
	this.path			= {};

	/**
	 * include relevant packages
	 */
	this.requireExternalDependencies = function() {
		this.chalk			= require('chalk');
		this.fs				= require('fs');
		this.path			= require('path');
	};

	/**
	 * recursively scans the directory
	 * @param  {String} dir      the directory to scan
	 * @param  {Array} filelist  is  an optional  parameter used recursively
	 * @return {Array}          a list of all files in dir
	 */
	this.walkSync = function(dir, filelist) {
		var fs, self;
		self = this;
		fs = fs || require('fs'),
		files = fs.readdirSync(dir);
		filelist = filelist || [];
		files.forEach(function(file) {
			if (fs.statSync(dir + '/' +file).isDirectory())
				filelist = self.walkSync(dir + '/' + file + '/', filelist);
			else
				filelist.push(dir+'/'+file);
		});
		return filelist;
	}; 

	this.readSignalFiles = function(fromFolder) {
		var curPath, files, itr, self;
		self = this;
		files = [];
		curPath = process.cwd() + '/' + fromFolder;
		if (this.fs.existsSync(curPath)) {
			files = files.concat(this.walkSync(curPath));
		}
		itr = function(path) {
			var curPath, cwd, files, i, packages;
			packages = [];
			if (!path)
				path = '';
			files = [];
			cwd = process.cwd();
			curPath = process.cwd() + path + '/node_modules';	
			if (self.fs.existsSync(curPath)) {
				packages = self.fs.readdirSync(curPath);
				for (i in packages) {
					if (self.fs.statSync(curPath + '/' + packages[i]).isDirectory()) {
						if (self.fs.existsSync(curPath + '/' + packages[i] + '/' + fromFolder))
							files = files.concat(self.walkSync(curPath + '/' + packages[i] + '/' + fromFolder));
						if (self.fs.existsSync(process.cwd() + path + '/node_modules/' + packages[i] + '/node_modules')) {
							files = files.concat(itr(path + '/node_modules/' + packages[i]));
						}
					}
				}
			}

			return files;
		};

		files = files.concat(itr()).reverse();
		return files;
	}

	/**
	 * reads the signals using a walksync
	 * @param  {String} fromFolder (optional) a folder to scan for instead of "signals"
	 */
	this.readSignals = function(fromFolder) {
		var files, i, path;

		if (typeof fromFolder == 'undefined')
			fromFolder 	= 'signals';

		files	= this.readSignalFiles(fromFolder);

		for (i in files) {
			if ( files[i].substr(-3) == '.js') {
				signal	= files[i].split('/')[files[i].split('/').length - 1];
				signal	= signal.substr(0, signal.length - '.js'.length);
				robots = Robots = this.parent();
				fn	= require(files[i]);
				if (typeof fn == 'function') 
					this.parent().registerIfNot(signal, fn);
				else if (typeof fn == 'object') {
					if (fn.desc)
						fn.description = fn.desc;
					if (!fn.description)
						fn.description = '';
					if (fn.callback)
						this.parent().registerIfNot(signal, fn.callback, fn.description);
					if (fn.signal)
						this.parent().registerIfNot(signal, fn.signal, fn.description);
					if (fn.fn)
						this.parent().registerIfNot(signal, fn.fn, fn.description);
					if (fn.test)
						this.parent().registerTestIfNot(signal, fn.test, fn.description);
				}
				else if (Array.isArray(fn)) {
					this.parent().registerIfNot(signal, fn[0]);
					this.parent().registerTest(signal, fn[1]);
				}
			}
		}
	};

	this.requireExternalDependencies();

	return this;
};

module.exports = signals;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Spiritbots.html">Spiritbots</a></li><li><a href="robots-signals%2520scans%2520for%2520the%2520signals%2520directory%2520and%2520each%2520file_s%2520export%2520function%250Dbecomes%2520a%2520signal%2520with%2520the%2520filenamemodule_.html">robots-signals scans for the signals directory and each file's export functionbecomes a signal with the filename</a></li></ul><h3>Classes</h3><ul><li><a href="module-Spiritbots-Robots.html">Robots</a></li><li><a href="robots-signals%2520scans%2520for%2520the%2520signals%2520directory%2520and%2520each%2520file_s%2520export%2520function%250Dbecomes%2520a%2520signal%2520with%2520the%2520filenamemodule_-signals.html">signals</a></li><li><a href="RobotsAPI.html">RobotsAPI</a></li><li><a href="RobotsHTTP.html">RobotsHTTP</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed May 25 2016 09:27:32 GMT-0600 (Mountain Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
