# robots

Spiritbots is a simple pub/sub message bus that supports async/await and network messaging.

[![Build Status][travis-image]][travis-url] [![Coverage Status][coveralls-image]][coveralls-url]

![Ambassador IO Logo](https://raw.githubusercontent.com/mgwhitfield/AmbassadorNode/master/logo-icon-64.PNG)

This library is a pub/sub message bus (functions have a one-to-many relationship) used in both client-side and server-side for [Spiritway](http://spiritway.co/). Also see the [GitHub Repository](https://github.com/spiritway/core).

## New

In this release, you can send messages across the network using `Robots.broadcast` and `Robots.beacon`.  In a networked environment, broadcast corresponds to the `Robots.relay` function and beacon corresponds to an asynchronously returned result (*see `Robots.relayAsync` which is also new*).

### Using Robots over the Network

After requiring the Ambassador Robots package into your application, you'll notice that a server begins listening in the console (**default port is 3333**).

## Documentation

`array        Robots.relay(signal, ...args)

Relays a signal to the message bus

`mixed        Robots.answer(signal, ...args)`

Like relay, but returns **one result** only, useful for conditionals

`array        Robots.register(signal, function(args))`

Register a function to listen to the message bus

`void        Robots.clear(signal)`

Clears all listeners for this signal

`void        Robots.relayAsync(signal, ...args, fn)`

Relays a signal to the message bus.  returns results as arguments of `fn`. *see `Robots.wait` and `Robots.finish`*

`string        Robots.wait(void)`

Returns a unique signal token to delay the return of results.  Used in conjunction with `Robots.finish`.

`void        Robots.finish(signalToken, ...results)`

returns the `results` to any listening signal caller.  *See below example*

## Delayed Return Signals

When writing functions that access the network or use timers, you need to delay the return of a signal.

Authoring the registration of a delayed signal requires three steps.

1) Somewhere before your function returns, you must generate a unique "wait token" by calling `Robots.wait`


2) **you must return the unique "wait token"**.  *Author's note: I am exploring the removal of this requirement.*


3) call `Robots.finish(signal,returnValue)` whenever you want to return the signal to the caller.

Here's an example snippet of what a delayed signal registrant looks like:

```
Robots.register('mysignal', function(a, b){
    var signal    = Robots.wait();
    setTimeout(function() {
        Robots.finish(signal, a + b);
    }, 500);
    return signal; // will not be required in future versions
});

Robots.relayAsync('mysignal', 1, 2, function(r){
    console.log("the sum is:", r);
})
```

Remember, you can mix and match delayed signal registrants with in-time registrants.

## Coming soon

* tutorial for Robots over HTTP
* signal traces for debugging, logging, and analytics

[travis-image]: https://travis-ci.org/spiritway/robots.png?branch=master
[travis-url]: https://travis-ci.org/spiritway/robots

[coveralls-image]: https://coveralls.io/repos/spiritway/robots/badge.svg
[coveralls-url]: https://coveralls.io/repos/spiritway/robots/badge.svg